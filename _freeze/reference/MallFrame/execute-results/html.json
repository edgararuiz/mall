{
  "hash": "c109260b5aebe0b4bff09096e96937e6",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: MallFrame\n---\n\n\n\n`MallFrame(self, df)`\n\nExtension to Polars that add ability to use\nan LLM to run batch predictions over a data frame\n\nLoads the neede libraries, and sets up the review\ndata frame that will be used in the examples below:\n\n\n::: {#375e1ae7 .cell execution_count=1}\n``` {.python .cell-code}\nimport mall\nimport polars as pl\npl.Config(fmt_str_lengths=100)\ndata = mall.MallData\nreviews = data.reviews\nreviews.llm.use(options = dict(seed = 100))\n```\n:::\n\n\n## Methods\n\n| Name | Description |\n| --- | --- |\n| [classify](#mall.MallFrame.classify) | Classify text into specific categories. |\n| [custom](#mall.MallFrame.custom) | Provide the full prompt that the LLM will process. |\n| [extract](#mall.MallFrame.extract) | Pull a specific label from the text. |\n| [sentiment](#mall.MallFrame.sentiment) | Use an LLM to run a sentiment analysis |\n| [summarize](#mall.MallFrame.summarize) | Summarise the text down to a specific number of words. |\n| [translate](#mall.MallFrame.translate) | Translate text into another language. |\n| [use](#mall.MallFrame.use) | Define the model, backend, and other options to use to |\n\n### classify { #mall.MallFrame.classify }\n\n`MallFrame.classify(col, labels='', additional='', pred_name='classify')`\n\nClassify text into specific categories.\n\n#### Parameters\n\n| Name         | Type   | Description                                                                                                             | Default      |\n|--------------|--------|-------------------------------------------------------------------------------------------------------------------------|--------------|\n| `col`        | str    | The name of the text field to process                                                                                   | _required_   |\n| `labels`     | list   | A list or a DICT object that defines the categories to classify the text as. It will return one of the provided labels. | `''`         |\n| `pred_name`  | str    | A character vector with the name of the new column where the prediction will be placed                                  | `'classify'` |\n| `additional` | str    | Inserts this text into the prompt sent to the LLM                                                                       | `''`         |\n\n#### Examples\n\n::: {#b1c29049 .cell execution_count=2}\n``` {.python .cell-code}\nreviews.llm.classify(\"review\", [\"appliance\", \"computer\"])\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>review</th><th>classify</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;This has been the best TV I&#x27;ve ever used. Great screen, and sound.&quot;</td><td>&quot;computer&quot;</td></tr><tr><td>&quot;I regret buying this laptop. It is too slow and the keyboard is too noisy&quot;</td><td>&quot;computer&quot;</td></tr><tr><td>&quot;Not sure how to feel about my new washing machine. Great color, but hard to figure&quot;</td><td>&quot;appliance&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {#6005ad84 .cell execution_count=3}\n``` {.python .cell-code}\n# Use 'pred_name' to customize the new column's name\nreviews.llm.classify(\"review\", [\"appliance\", \"computer\"], pred_name=\"prod_type\")\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>review</th><th>prod_type</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;This has been the best TV I&#x27;ve ever used. Great screen, and sound.&quot;</td><td>&quot;computer&quot;</td></tr><tr><td>&quot;I regret buying this laptop. It is too slow and the keyboard is too noisy&quot;</td><td>&quot;computer&quot;</td></tr><tr><td>&quot;Not sure how to feel about my new washing machine. Great color, but hard to figure&quot;</td><td>&quot;appliance&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {#f29d9da2 .cell execution_count=4}\n``` {.python .cell-code}\n#Pass a DICT to set custom values for each classification\nreviews.llm.classify(\"review\", {\"appliance\" : \"1\", \"computer\" : \"2\"})\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>review</th><th>classify</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;This has been the best TV I&#x27;ve ever used. Great screen, and sound.&quot;</td><td>&quot;1&quot;</td></tr><tr><td>&quot;I regret buying this laptop. It is too slow and the keyboard is too noisy&quot;</td><td>&quot;2&quot;</td></tr><tr><td>&quot;Not sure how to feel about my new washing machine. Great color, but hard to figure&quot;</td><td>&quot;1&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### custom { #mall.MallFrame.custom }\n\n`MallFrame.custom(col, prompt='', valid_resps='', pred_name='custom')`\n\nProvide the full prompt that the LLM will process.\n\n#### Parameters\n\n| Name        | Type   | Description                                                                            | Default    |\n|-------------|--------|----------------------------------------------------------------------------------------|------------|\n| `col`       | str    | The name of the text field to process                                                  | _required_ |\n| `prompt`    | str    | The prompt to send to the LLM along with the `col`                                     | `''`       |\n| `pred_name` | str    | A character vector with the name of the new column where the prediction will be placed | `'custom'` |\n\n### extract { #mall.MallFrame.extract }\n\n`MallFrame.extract(col, labels='', additional='', pred_name='extract')`\n\nPull a specific label from the text.\n\n#### Parameters\n\n| Name         | Type   | Description                                                                            | Default     |\n|--------------|--------|----------------------------------------------------------------------------------------|-------------|\n| `col`        | str    | The name of the text field to process                                                  | _required_  |\n| `labels`     | list   | A list or a DICT object that defines tells the LLM what to look for and return         | `''`        |\n| `pred_name`  | str    | A character vector with the name of the new column where the prediction will be placed | `'extract'` |\n| `additional` | str    | Inserts this text into the prompt sent to the LLM                                      | `''`        |\n\n### sentiment { #mall.MallFrame.sentiment }\n\n`MallFrame.sentiment(col, options=['positive', 'negative', 'neutral'], additional='', pred_name='sentiment')`\n\nUse an LLM to run a sentiment analysis\n\n#### Parameters\n\n| Name         | Type         | Description                                                                            | Default                               |\n|--------------|--------------|----------------------------------------------------------------------------------------|---------------------------------------|\n| `col`        | str          | The name of the text field to process                                                  | _required_                            |\n| `options`    | list or dict | A list of the sentiment options to use, or a named DICT object                         | `['positive', 'negative', 'neutral']` |\n| `pred_name`  | str          | A character vector with the name of the new column where the prediction will be placed | `'sentiment'`                         |\n| `additional` | str          | Inserts this text into the prompt sent to the LLM                                      | `''`                                  |\n\n#### Examples\n\n::: {#d2ec2cc6 .cell execution_count=5}\n``` {.python .cell-code}\nreviews.llm.sentiment(\"review\")\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>review</th><th>sentiment</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;This has been the best TV I&#x27;ve ever used. Great screen, and sound.&quot;</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;I regret buying this laptop. It is too slow and the keyboard is too noisy&quot;</td><td>&quot;negative&quot;</td></tr><tr><td>&quot;Not sure how to feel about my new washing machine. Great color, but hard to figure&quot;</td><td>&quot;neutral&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {#abd220cb .cell execution_count=6}\n``` {.python .cell-code}\n# Use 'pred_name' to customize the new column's name\nreviews.llm.sentiment(\"review\", pred_name=\"review_sentiment\")\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>review</th><th>review_sentiment</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;This has been the best TV I&#x27;ve ever used. Great screen, and sound.&quot;</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;I regret buying this laptop. It is too slow and the keyboard is too noisy&quot;</td><td>&quot;negative&quot;</td></tr><tr><td>&quot;Not sure how to feel about my new washing machine. Great color, but hard to figure&quot;</td><td>&quot;neutral&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {#4ccd2134 .cell execution_count=7}\n``` {.python .cell-code}\n# Pass custom sentiment options\nreviews.llm.sentiment(\"review\", [\"positive\", \"negative\"])\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>review</th><th>sentiment</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;This has been the best TV I&#x27;ve ever used. Great screen, and sound.&quot;</td><td>&quot;positive&quot;</td></tr><tr><td>&quot;I regret buying this laptop. It is too slow and the keyboard is too noisy&quot;</td><td>&quot;negative&quot;</td></tr><tr><td>&quot;Not sure how to feel about my new washing machine. Great color, but hard to figure&quot;</td><td>&quot;negative&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {#4c66807b .cell execution_count=8}\n``` {.python .cell-code}\n# Use a DICT object to specify values to return per sentiment\nreviews.llm.sentiment(\"review\", {\"positive\" : \"1\", \"negative\" : \"0\"})\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (3, 2)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>review</th><th>sentiment</th></tr><tr><td>str</td><td>str</td></tr></thead><tbody><tr><td>&quot;This has been the best TV I&#x27;ve ever used. Great screen, and sound.&quot;</td><td>&quot;1&quot;</td></tr><tr><td>&quot;I regret buying this laptop. It is too slow and the keyboard is too noisy&quot;</td><td>&quot;0&quot;</td></tr><tr><td>&quot;Not sure how to feel about my new washing machine. Great color, but hard to figure&quot;</td><td>&quot;0&quot;</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### summarize { #mall.MallFrame.summarize }\n\n`MallFrame.summarize(col, max_words=10, additional='', pred_name='summary')`\n\nSummarise the text down to a specific number of words.\n\n#### Parameters\n\n| Name         | Type   | Description                                                                            | Default     |\n|--------------|--------|----------------------------------------------------------------------------------------|-------------|\n| `col`        | str    | The name of the text field to process                                                  | _required_  |\n| `max_words`  | int    | Maximum number of words to use for the summary                                         | `10`        |\n| `pred_name`  | str    | A character vector with the name of the new column where the prediction will be placed | `'summary'` |\n| `additional` | str    | Inserts this text into the prompt sent to the LLM                                      | `''`        |\n\n### translate { #mall.MallFrame.translate }\n\n`MallFrame.translate(col, language='', additional='', pred_name='translation')`\n\nTranslate text into another language.\n\n#### Parameters\n\n| Name         | Type   | Description                                                                            | Default         |\n|--------------|--------|----------------------------------------------------------------------------------------|-----------------|\n| `col`        | str    | The name of the text field to process                                                  | _required_      |\n| `language`   | str    | The target language to translate to. For example 'French'.                             | `''`            |\n| `pred_name`  | str    | A character vector with the name of the new column where the prediction will be placed | `'translation'` |\n| `additional` | str    | Inserts this text into the prompt sent to the LLM                                      | `''`            |\n\n### use { #mall.MallFrame.use }\n\n`MallFrame.use(backend='', model='', _cache='_mall_cache', **kwargs)`\n\nDefine the model, backend, and other options to use to\ninteract with the LLM.\n\n#### Parameters\n\n| Name       | Type   | Description                                                                                                                                            | Default         |\n|------------|--------|--------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------|\n| `backend`  | str    | The name of the backend to use. At the beginning of the session it defaults to \"ollama\". If passing `\"\"`, it will remain unchanged                     | `''`            |\n| `model`    | str    | The name of the model tha the backend should use. At the beginning of the session it defaults to \"llama3.2\". If passing `\"\"`, it will remain unchanged | `''`            |\n| `_cache`   | str    | The path of where to save the cached results. Passing `\"\"` disables the cache                                                                          | `'_mall_cache'` |\n| `**kwargs` |        | Arguments to pass to the downstream Python call. In this case, the `chat` function in `ollama`                                                         | `{}`            |\n\n",
    "supporting": [
      "MallFrame_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}